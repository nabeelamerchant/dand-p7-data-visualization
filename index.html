<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://dimplejs.org/dist/dimple.v2.0.0.min.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Abel" rel="stylesheet">
  
  <style>
    body{
      font-family: 'Abel', sans-serif;
    }

    h2 {
      font-weight: bold;
    }

    div.percent_button {
        position: absolute;
        top: 65px;
        left: 120px;
        background-color: #ccc; /*light grey*/
        padding: 3px;
        margin: 7px;
        border-radius: 5px;
    }
    
    div.abs_button {
        position: absolute;
        top: 65px;
        left: 50px;
        background-color: #ff9f1c; /*orange*/
        padding: 3px;
        margin: 7px;
        border-radius: 5px;
    }

    </style>

    <script type="text/javascript">

		function draw(data) {
      
      //D3.js setup code

          "use strict";
          var margin = 75,
              width = 1000 - margin,
              height = 600 - margin;

      //Title
          d3.select("body").append("h2").text("How gender and ticket class affected survival rates on the Titanic");

      //SVG    
          var svg = d3.select("body")
            .append("svg")
              .attr("width", width + margin)
              .attr("height", height + margin)
            .append('g')
                .attr('class','chart');

      //Data manipulation
        
        // Create a column of 1s for Count
            data.forEach(function(d) {
                return d.Number_of_Passengers = 1;
                        });

        // Update Survived from 1 & 0 to Yes & No
            data.forEach(function(d) {
                if (d.Survived == 1) {
                    d.Status = "Survived";
                } else {
                    d.Status = "Perished";
                }
            });

      //Functions
          
          function setChartProp(svg,myChart,x,x_label) {
            //axes
            var y = myChart.addCategoryAxis("y", ["Pclass", "Sex"]);
            y.title = "Ticket Class Survival By Gender"
            y.addOrderRule([3,2,1]); 
            x.title = x_label;
            //plot
            var s = myChart.addSeries("Status", dimple.plot.bar);
            //changes the order to show survivors first
            s.addOrderRule(["Survived","Perished"]); 
            //legend
            var myLegend = myChart.addLegend(200, 10, 380, 20,"right");
            myChart.legendLabel = "Did they survive:"; //doesn't work
            //set some colours
            //myChart.defaultColors = [new dimple.color("orange"),new dimple.color("blue")];  // You can use #RGB here 
            //draw chart
            myChart.draw();
          }

          function unclicked_button(sel_button){
            d3.select(sel_button)
              .transition()
              .duration(100)
              .style("color","black")
              .style("background","#ccc") //light grey
          }

          function clicked_button(sel_object){
            d3.select(sel_object)
              .transition()
              .duration(100)
              .style("background","#ff9f1c") //orange
              .style("color","black");
          }

      //Initial Chart
          var myChart = new dimple.chart(svg, data);
          var x = myChart.addMeasureAxis("x", "Number_of_Passengers");
          setChartProp(svg,myChart,x,"Number of Passengers");


       //Percentage Button 
          var p_button = d3.select("body")
            .append("div")
              .attr("class","percent_button buttons")
              //.attr("class","buttons")
              .text("Percentage");
              
          p_button.on("click",function(){
            //change style of previous button
            unclicked_button(".abs_button")

            //changes style of selected button
            clicked_button(this)

            //update chart
            svg.selectAll("*").remove();
            myChart = new dimple.chart(svg, data);
            x = myChart.addPctAxis("x", "Number_of_Passengers"); 
            setChartProp(svg,myChart,x,"Percentage of Passengers");
          })

      //Absolute Button
          var a_button = d3.select("body")
            .append("div")
              .attr("class","abs_button buttons")
              //.attr("class","buttons")
              .text("Count");
              
          a_button.on("click",function(){
            //change style of previous button
            unclicked_button(".percent_button")

            //changes style of selected button
            clicked_button(this)

            //update chart
            svg.selectAll("*").remove();
            myChart = new dimple.chart(svg, data);
            x = myChart.addMeasureAxis("x", "Number_of_Passengers"); 
            setChartProp(svg,myChart,x,"Number of Passengers");
          })
          
          

          //d3.selectAll(".dimple-female.dimple-survived").style("fill","green");
           

/*svg.append("text")      // text label for the x axis
              .attr("x", 265 )
              .attr("y",  240 )
              .style("text-anchor", "middle")
              .text("Date");*/

      };
    </script>
  </head>

<body>
  
  <script type="text/javascript">
  /*
    Load the CSV file and pass the contents 
    of it to the draw function
    */
  d3.csv("titanic-data.csv", draw);

  /*
Findings from the Titanic dataset that I want to share:
- Women had a higher rate of survival (Gender)
- Those in the higher ticket class had a better rate of survival (Ticket Class)
- Children had a better rate of survival as well (Age)

Potential Visualizations:
- Scatter plot of survived vs didn't survive based on g
*/
  </script>
</body>
</html>


